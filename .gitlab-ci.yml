stages:
    - test
    - build
    - deploy

test:
    image: node:17-alpine
    stage: test
    tags: 
        - test
    script:
        - npm install
        - npm test


build:
    image: docker:20.10.16
    stage: build
    tags:
        - build
    services:
        - docker:20.10.16-dind
    before_script:
        - docker login -u "$CI_REGISTRY_USER" -p "$CI_REGISTRY_PASSWORD" $CI_REGISTRY
    script:
        - docker build --pull -t "$CI_REGISTRY_IMAGE" .
        - docker push "$CI_REGISTRY_IMAGE"

deploy:
    image: bitnami/git:latest
    stage: deploy
    tags:
        - build
    script:
        - git remote set-url origin https://ZeljkoCarevic:gradsplit1@github.com/ZeljkoCarevic/react-docker.git
        - git push --mirror github



